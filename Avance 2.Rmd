---
title: "Avance 2"
author: "Tukey Tukey Tukey Ta"
date: "30/10/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

#### **Grupo:** Tukey Tukey Tukey Ta      
      
#### **Integrantes:**      
* Paz Berru, Juan Antonio       
* Salazar Rodriguez, Mattias Gustavo       
       
#### **Tema:** Factores sociales y económicos que influyeron en la opción de voto de las elecciones presidenciales de Perú del 2016      
       
#### **Pregunta de investigación:** ¿En qué medida factores económicos y sociales influyeron en la opción de voto en la primera vuelta de las elecciones presidenciales de Perú en el 2016?         
        
#### **Base de Datos:** LAPOP: Perú, 2019     
       
#### **Variable Dependiente**: ¿Por quién votó para Presidente en la primera vuelta de las últimas elecciones
presidenciales de 2016?         
      
#### **Variables Independientes**:           
    
* Sexo   
* Edad
* ¿Considera usted que su situación económica actual es mejor, igual o peor que la de hace doce meses?
* ¿En los últimos 12 meses ha participado en una manifestación o protesta pública?
* Nivel de satisfacción con la calidad de los servicios de salud públicos
* Si tiene afinidad con algún partido político
* ¿Qué tan de acuerdo o en desacuerdo está usted con la siguiente frase? Cuando la madre trabaja fuera de la casa, los hijos sufren
*¿Usted o alguien en su casa recibe ayuda periódica en dinero, alimento o en productos de parte del gobierno, sin contar las pensiones?
* ¿Es beneficiario del programa "Juntos"?
* ¿A qué se dedica usted principalmente?
      
```{r include=FALSE}
library(rio)
library(fastDummies)
library(reshape2)
library(DescTools)
library(MASS)
library(dplyr)
library(RVAideMemoire)
library(car)
library(tidyverse)
library(psych)
library(descr)
library(nnet)
library(survey)
```
     
```{r}
data=import("LAPOP_PERU_2019.dta")
```
   
## Análisis Exploratorio de Datos:   

En primer lugar, se recodificará a las variables independientes y la dependiente, según el cuestionario de LAPOP.     
```{r}
data$q1<-as.factor(data$q1)
levels(data$q1)<-c("hombre","mujer")
data$idio2 <- recode(data$idio2, "1=3; 3=1")
data$idio2<-as.ordered(data$idio2)
levels(data$idio2)<-c("peor","igual","mejor")
data$prot3<-as.factor(data$prot3)
levels(data$prot3)<-c("si","no")
data$sd6new2 <- recode(data$sd6new2, "4=1; 3=2;2=3;1=4")
data$sd6new2<-as.ordered(data$sd6new2)
levels(data$sd6new2)<-c("muy_insatisfecho","insatisfecho","satisfecho","muy_satisfecho")
data$vb10<-as.factor(data$vb10)
levels(data$vb10)<-c("si","no")
data$vb3n <- recode(data$vb3n, "0=97;1104=1177; 1105=1177;1106=1177;1107=1177;1108=1177")
data$vb3n<-as.factor(data$vb3n)
levels(data$vb3n)<-c("Ninguno","Pedro Pablo Kuczynski","Keiko Fujimori","Verónika Mendoza","Otro")
data$vb58 <- recode(data$vb58, "4=1; 3=2;2=3;1=4")
data$vb58<-as.ordered(data$vb58)
levels(data$vb58)<-c("muy_en_desacuerdo","en_desacuerdo","de_acuerdo","muy_de_acuerdo")
data$wf1<-as.factor(data$wf1)
levels(data$wf1)<-c("si","no")
data$cct1b<-as.factor(data$cct1b)
levels(data$cct1b)<-c("si","no")
data$ocup4a <- recode(data$ocup4a, "2=1; 7=3")
data$ocup4a<-as.factor(data$ocup4a)
levels(data$ocup4a)<-c("trabaja","no_trabaja","estudiante","hogar","jubilado")
```
    
```{r}
data1=subset(data, select = c(q1,q2,idio2,prot3,sd6new2,vb10,vb3n,vb58,wf1,cct1b,ocup4a))
data1=na.omit(data1)
str(data1)
```
    
Podemos ver que todas las variables han sido modificadas para que puedan ser utilizadas correctamente. A continuación observaremos un pequeño resumen de cada variable.   
    
Voto en la primera vuelta:
```{r}
attach(data1)
table(vb3n)
```


Sexo:   
```{r}
table(q1)
```
     
Edad:   
```{r}
summary(q2)
```
     
Comparación de situación económica:   
```{r}
table(idio2)
```
     
Participación en protestas:
```{r}
table(prot3)
```
     
Nivel de satisfacción con servicios de salud pública:
```{r}
table(sd6new2)
```
     
Afinidad con algún partido político:
```{r}
table(vb10)
```
     
Nivel de acuerdo con la frase: "Cuando la madre trabaja fuera de la casa, los hijos sufren"
```{r}
table(vb58)
```
     
Recibe ayuda económica del Gobierno:
```{r}
table(wf1)
```
     
Beneficiario del programa Juntos:
```{r}
table(cct1b)
```
      
Ocupación actual:  
```{r}
table(ocup4a)
```
    
## Creación de un modelo de regresión:   
    
Debido a que la variable independiente es una nominal no dicotómica, el modelo más óptimo es el multinomial. En esta primera parte se llevará a cabo un modelo de regresión que incluya todas las variables, para tener una primera aproximación a su relación. Sin embargo, antes de hacer el modelo hace falta crearle dummies a las variables categóricas que tienen más de 2 valores.   
    
```{r}
data1<-cbind(dummy_cols(data1,  select_columns = c("idio2")))
data1<-cbind(dummy_cols(data1,  select_columns = c("sd6new2")))
data1<-cbind(dummy_cols(data1,  select_columns = c("vb58")))
data1<-cbind(dummy_cols(data1,  select_columns = c("ocup4a")))
```

     
```{r}
modelo1 <- multinom(vb3n ~ q1 + q2 + idio2_peor + idio2_igual + prot3 + sd6new2_muy_insatisfecho + sd6new2_insatisfecho + sd6new2_satisfecho + vb10 + vb58_muy_en_desacuerdo + vb58_en_desacuerdo + vb58_de_acuerdo + wf1 + cct1b + ocup4a_trabaja +  ocup4a_no_trabaja + ocup4a_estudiante +ocup4a_hogar, data = data1)
summary(modelo1)
```
      
Ahora se comprobará la validez del modelo y de las variables:   
    
```{r}
modelo0=multinom(vb3n ~ 1, data = data1)
summary(modelo0)
```
      
```{r}
anova1=anova(modelo0,modelo1)
anova1
```
     
Notamos que el Chi es diferente de 0, por lo tanto, lo mejor sería utilizar un modelo que tenga menos variables. Se probará con distintos modelos y se probará cual es el más óptimo.    
     